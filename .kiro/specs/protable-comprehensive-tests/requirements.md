# ProTable 组件综合测试覆盖需求

## 介绍

本规范概述了 React Admin Kit 库中 ProTable 组件的综合测试需求。ProTable 组件是一个基于 Ant Design ProTable 构建的复杂表格组件，集成了模态表单、删除功能、搜索能力、导出功能和广泛的自定义选项。目标是实现全面的测试覆盖，确保所有功能的可靠性、可维护性和正确性。

## 需求

### 需求 1: 核心组件渲染和属性

**用户故事:** 作为开发者，我希望确保 ProTable 组件在各种属性配置下都能正确渲染，以便我可以信任其基本功能。

#### 验收标准

1. 当 ProTable 使用最少属性渲染时，组件应该无错误渲染
2. 当 ProTable 接收 columns 配置时，应该显示正确的表格结构
3. 当 ProTable 接收 request 函数时，应该调用请求并显示数据
4. 当 ProTable 接收自定义 rowKey 时，应该使用正确的行标识
5. 当 ProTable 接收 name 属性时，应该显示正确的标题
6. 当 ProTable 接收 locale 属性时，应该显示指定语言的文本

### 需求 2: 数据加载和请求处理

**用户故事:** 作为开发者，我希望验证数据加载在所有场景下都能正确工作，以便用户看到准确和最新的信息。

#### 验收标准

1. 当提供 request 函数时，ProTable 应该使用正确的参数调用它
2. 当请求成功时，ProTable 应该显示返回的数据
3. 当请求失败时，ProTable 应该优雅地处理错误
4. 当请求加载中时，ProTable 应该显示加载指示器
5. 当分页改变时，ProTable 应该使用更新的参数调用请求
6. 当搜索过滤器改变时，ProTable 应该使用搜索参数调用请求
7. 当排序参数改变时，ProTable 应该使用排序参数调用请求

### 需求 3: 模态表单集成

**用户故事:** 作为开发者，我希望模态表单与表格无缝集成，以便用户可以创建和编辑记录。

#### 验收标准

1. 当提供 columns 配置时，模态表单应该根据列配置渲染表单字段
2. 当点击创建按钮时，应该打开空的模态表单
3. 当点击编辑按钮时，应该打开预填充数据的模态表单
4. 当提交表单时，应该调用 onFinish 函数并传递表单数据
5. 当表单提交成功时，应该关闭模态框并刷新表格数据
6. 当表单验证失败时，应该显示错误信息并保持模态框打开
7. 当使用 formType 时，模态框标题应该相应更新

### 需求 4: 删除功能

**用户故事:** 作为开发者，我希望有完整的删除功能，包括适当的确认和权限控制，以便用户可以安全地删除记录。

#### 验收标准

1. 当提供 delFunction 时，删除按钮应该在操作列中可见
2. 当点击删除按钮时，应该出现确认对话框
3. 当确认删除时，应该使用正确的参数调用 delFunction
4. 当删除成功时，应该显示成功消息并重新加载表格
5. 当删除失败时，应该优雅地处理错误
6. 当 delPermission 返回 false 时，删除按钮应该被隐藏
7. 当按行配置 enableDelete 时，删除按钮应该遵循行级设置
8. 当选择多行时，应该提供批量删除功能
9. 当 delConfirmType 是 'modal' 时，应该使用模态确认而不是 popconfirm

### 需求 5: 行选择和批量操作

**用户故事:** 作为开发者，我希望行选择与批量操作正确配合工作，以便用户可以对多个记录执行操作。

#### 验收标准

1. 当启用 rowSelection 时，表格中应该出现复选框
2. 当选择行时，selectedRowKeys 应该被更新
3. 当选择行时，表格警告应该显示选择信息
4. 当启用批量删除时，删除选项应该出现在警告中
5. 当执行批量删除时，所有选中的行应该被删除
6. 当清除选择时，警告应该消失
7. 当使用受控选择时，应该遵循外部状态

### 需求 6: 导出功能

**用户故事:** 作为开发者，我希望导出功能在各种数据格式下正确工作，以便用户可以提取表格数据。

#### 验收标准

1. 当调用 export 方法时，应该生成正确的 Excel 文件
2. 当提供自定义文件名时，导出的文件应该使用该名称
3. 当定义 renderExport 时，应该正确格式化导出数据
4. 当列有导出配置时，应该只包含可导出的列
5. 当提供 beforeExport 回调时，应该在导出前调用它
6. 当导出选中行时，应该只包含选中的数据

### 需求 7: 列配置和渲染

**用户故事:** 作为开发者，我希望列配置在表格和表单上下文中正确工作，以便数据被正确显示和编辑。

#### 验收标准

1. 当列的 type 是 'form' 时，应该只出现在模态表单中
2. 当列的 type 是 'table' 时，应该只出现在表格中
3. 当列的 type 是 'search' 时，应该只出现在搜索表单中
4. 当列有自定义 render 函数时，应该接收 innerRef 参数
5. 当列有 valueType 时，应该使用正确的组件渲染
6. 当列有 fieldProps 函数时，应该接收 form 和 innerRef 参数
7. 当提供嵌套列时，表格应该显示分组标题

### 需求 8: 样式和布局

**用户故事:** 作为开发者，我希望样式和布局选项正确工作，以便组件适应不同的设计要求。

#### 验收标准

1. 当 noPadding 为 true 时，应该移除卡片内边距
2. 当提供 toolbar title 时，应该在标题中显示
3. 当提供 toolbar actions 时，应该在标题中显示
4. 当提供 optionColumnSpaceProps 时，应该应用操作列间距
5. 当提供 tableAlertOption spaceProps 时，应该应用警告间距

### 需求 9: 国际化

**用户故事:** 作为开发者，我希望国际化正确工作，以便组件可以在不同语言中使用。

#### 验收标准

1. 当 locale 设置为 zh_CN 时，应该显示中文文本
2. 当 locale 设置为 en_US 时，应该显示英文文本
3. 当提供自定义 locale 时，应该使用自定义文本
4. 当 formType 改变时，模态框标题应该使用正确的 locale 更新

### 需求 10: 错误处理和边界情况

**用户故事:** 作为开发者，我希望组件优雅地处理错误和边界情况，以便用户有流畅的体验。

#### 验收标准

1. 当请求抛出错误时，表格应该显示错误状态
2. 当 onFinish 抛出错误时，模态框应该保持打开并处理错误
3. 当 delFunction 抛出错误时，删除操作应该被取消并显示错误消息
4. 当提供无效数据时，组件应该处理而不崩溃
5. 当组件在异步操作期间卸载时，应该防止内存泄漏
6. 当发生快速用户交互时，组件应该正确处理

### 需求 11: 与 SettingProvider 集成

**用户故事:** 作为开发者，我希望 ProTable 与 SettingProvider 正确配合工作，以便全局配置被一致应用。

#### 验收标准

1. 当 SettingProvider 提供默认属性时，应该正确合并
2. 当本地属性与提供者属性冲突时，本地属性应该优先
3. 当提供者设置改变时，组件应该相应更新
4. 当使用嵌套提供者时，最近的提供者应该优先