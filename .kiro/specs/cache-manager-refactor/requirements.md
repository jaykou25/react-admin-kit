# 需求文档

## 介绍

此功能涉及重构 rehype 插件的 core/cache-manager 类，以消除对集中式缓存索引（index.json）文件的依赖。当前实现同时维护集中式索引文件和单独的缓存条目文件，这导致 index.json 文件频繁变更和潜在的同步问题。重构后的系统将仅通过单独的条目文件管理所有缓存操作，提高性能并减少文件系统变动。

## 需求

### 需求 1

**用户故事：** 作为使用 rehype 插件的开发者，我希望缓存系统在没有集中式索引文件的情况下运行，以便缓存目录有更少的文件变更和更好的性能。

#### 验收标准

1. 当缓存管理器初始化时，系统不应创建或读取 index.json 文件
2. 当检查缓存有效性时，系统应扫描单独的条目文件而不是查询 index.json
3. 当检索缓存的演示信息时，系统应直接从单独的条目文件读取
4. 当保存缓存条目时，系统应仅写入单独的条目文件而不更新任何索引文件

### 需求 2

**用户故事：** 作为开发者，我希望缓存系统保持相同的 API 接口，以便现有代码无需修改即可继续工作。

#### 验收标准

1. 当使用 CacheManager 的任何公共方法时，方法签名应保持不变
2. 当调用 isCacheValid() 时，它应返回与之前相同的布尔结果
3. 当调用 getCachedDemo() 时，它应返回与之前相同的 DemoInfo 结构
4. 当调用 setCachedDemo() 时，它应接受与之前相同的参数
5. 当调用缓存管理方法时，它们应提供与之前相同的功能

### 需求 3

**用户故事：** 作为开发者，我希望缓存系统高效地发现和管理缓存条目，以便在没有集中式索引的情况下性能保持最优。

#### 验收标准

1. 当扫描缓存条目时，系统应使用高效的文件系统操作
2. 当确定缓存有效性时，系统应最小化文件 I/O 操作
3. 当清理过期缓存时，系统应在不读取所有文件的情况下识别条目
4. 当获取缓存统计信息时，系统应从可用的条目文件计算指标

### 需求 4

**用户故事：** 作为开发者，我希望缓存系统一致地处理文件路径规范化，以便缓存查找在不同操作系统上可靠工作。

#### 验收标准

1. 当存储缓存条目时，文件路径应一致地规范化
2. 当查找缓存条目时，系统应正确处理路径变化
3. 当生成条目文件名时，它们应从规范化的文件路径派生
4. 当从旧系统迁移时，现有缓存条目应可被发现

### 需求 5

**用户故事：** 作为开发者，我希望缓存系统优雅地处理丢失或损坏的条目文件，以便系统保持健壮和自愈能力。

#### 验收标准

1. 当条目文件丢失时，系统应将其视为缓存未命中
2. 当条目文件损坏时，系统应忽略它并继续操作
3. 当发生文件系统错误时，系统应记录警告并优雅地继续
4. 当缓存目录不存在时，系统应根据需要创建它