"use strict";(self.webpackChunkreact_admin_kit=self.webpackChunkreact_admin_kit||[]).push([[634],{15634:function(pr,ze,v){v.r(ze),v.d(ze,{BusinessSelectBuilder:function(){return Yt},BusinessTreeSelectBuilder:function(){return nr},Button:function(){return dn},FormUpload:function(){return dr},LinkButton:function(){return ye},ModalForm:function(){return ln},ProForm:function(){return Ln},ProTable:function(){return Lt},SchemaForm:function(){return en},SettingProvider:function(){return cr},clearSelectCache:function(){return Gt},clearTreeSelectCache:function(){return tr}});var Pn=v(97857),d=v.n(Pn),bn=v(5574),q=v.n(bn),Rn=v(15009),ce=v.n(Rn),Tn=v(99289),Ke=v.n(Tn),$n=v(13769),E=v.n($n),xn=v(7761),Fe=v(65520),S=v(67294),Dn=v(9783),p=v.n(Dn),Kn=v(52677),Ce=v.n(Kn);function ne(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t={};return Object.keys(r).forEach(function(a){var l=r[a];Ce()(l)==="object"&&l!==null&&!Array.isArray(l)&&(l=ne(l));var e=a.split("_"),n=q()(e,2),o=n[0],i=n[1],s=o.split(",");if(s.length>1){var u,c,m=q()(s,2),f=m[0],h=m[1],F=i?i.split(","):[],y=q()(F,2),C=y[0],b=C===void 0?"value":C,R=y[1],x=R===void 0?"label":R;t[f]=(u=l)===null||u===void 0?void 0:u[b],t[h]=(c=l)===null||c===void 0?void 0:c[x]}else t[a]=l}),t}function In(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=t.split("_"),l=q()(a,2),e=l[0],n=l[1],o=e.split(",");if(o.length>1){var i=q()(o,2),s=i[0],u=i[1],c=n?n.split(","):[],m=q()(c,2),f=m[0],h=f===void 0?"value":f,F=m[1],y=F===void 0?"label":F;return r[s]===void 0&&r[u]===void 0?void 0:p()(p()({},h,r[s]),y,r[u])}else return r[t]}function Ee(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r&&(Object.keys(t).forEach(function(a){var l=t[a];Ce()(l)==="object"&&Ee(r[a],l),On(a)&&(r[a]=In(r,a))}),r)}function On(r){return r&&typeof r=="string"&&r.includes(",")}function vr(r,t){var a=new RegExp(t),l=new RegExp(/\s*:\s*[\'\"]([^\"\']*)[\'\"]/,"g"),e=new RegExp(a.source+l.source,"g"),n=r.matchAll(e);return Array.from(n).map(function(o){return o[1]})}function Ie(r,t){var a=t.getFieldsValue,l=t.setFieldsValue,e=t.callback,n=a(),o=Ee(r,n);l(o),setTimeout(function(){var i=a(),s=Ee(r,i);l(s),e&&e(s)},50)}function Oe(){var r={data:{},setData:function(a){Object.keys(a).forEach(function(l){r.data[l]=a[l]})}};return r}var P=v(85893),jn=["onFinish","formRef","initialValues","children","innerRef"],Ye=(0,S.createContext)(void 0),Ge=(0,S.createContext)(!1),Bn=function(t){var a=t.onFinish,l=t.formRef,e=t.initialValues,n=t.children,o=t.innerRef,i=E()(t,jn),s=(0,S.useRef)(),u=(0,S.useRef)(Oe()),c=function(){return o||s};(0,S.useImperativeHandle)(c(),function(){return{data:u.current.data,setData:u.current.setData}});var m=function(){var I=Ke()(ce()().mark(function M(V){return ce()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(!a){D.next=4;break}return D.next=3,a(ne(V));case 3:return D.abrupt("return");case 4:return D.abrupt("return",new Promise(function(L){L(!0)}));case 5:case"end":return D.stop()}},M)}));return function(V){return I.apply(this,arguments)}}(),f=Fe.Z.useForm(),h=q()(f,1),F=h[0],y=Fe.Z.useFormInstance(),C=(0,S.useRef)(t.form||y||F),b=(0,S.useRef)(),R=(0,S.useRef)(void 0),x=(0,S.useState)(1),O=q()(x,2),T=O[0],j=O[1];return(0,S.useEffect)(function(){if(C.current){var I=C.current,M=I.getFieldsValue,V=I.setFieldsValue;C.current=d()(d()({},C.current),{},{setFieldsValue:function(D){var L;Ie(D,{getFieldsValue:M,setFieldsValue:V}),(L=c().current)===null||L===void 0||L.setData(D||{})}}),e?Ie(e,{getFieldsValue:M,setFieldsValue:V,callback:function(D){R.current=D,j(function(L){return L+1})}}):j(function(Z){return Z+1})}},[]),(0,S.useImperativeHandle)(l,function(){if(b.current){var I=b.current,M=I.getFieldsValue,V=I.validateFields,Z=I.getFieldsFormatValue,D=I.validateFieldsReturnFormatValue;return d()(d()({},b.current),{},{getFieldsValue:function(){return ne(M.apply(void 0,arguments))},getFieldsFormatValue:Z?function(L,z){return ne(Z(L,z))}:void 0,validateFields:function(){return V.apply(void 0,arguments).then(function(z){return ne(z)})},validateFieldsReturnFormatValue:D?function(L){return D(L).then(function(z){return ne(z)})}:void 0})}},[T]),(0,P.jsx)(Ye.Provider,{value:c(),children:(0,P.jsx)(Ge.Provider,{value:t.readonly||!1,children:(0,P.jsx)(xn.A,d()(d()({onFinish:m,initialValues:R.current,formRef:b},i),{},{form:C.current,children:n}),T)})})},Ln=Bn,Mn=v(2514),Vn=v(47426),Ae=v(12902),wn=v(71230),Je=S.createContext(void 0),Qe=S.createContext(void 0),Xe=S.createContext(void 0),qe=S.createContext(void 0),En=v(36669),je=v(22270),An=v(12795),Un=v(51812),_e=function r(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"form",l=arguments.length>2?arguments[2]:void 0,e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=e.labelCol,o=n===void 0?{}:n,i=e.valueBaseName,s=e.colProps,u=s===void 0?{}:s,c=e.readonly,m=c===void 0?!1:c;return t.filter(function(f){return!(f.hideInForm&&a==="form")}).sort(function(f,h){return h.order||f.order?(h.order||0)-(f.order||0):(h.index||0)-(f.index||0)}).map(function(f,h){var F,y=(0,je.h)(f.title,f,"form",(0,P.jsx)(An.G,{label:f.title,tooltip:f.tooltip||f.tip})),C=function(T,j){if(j){if(typeof T=="string")return[j,T];if(Array.isArray(T))return[j].concat(T)}return T},b=(0,Un.Y)(d()(d()({},f),{},{title:y,label:y,valueType:(0,je.h)(f.valueType,{}),dataIndex:C(f.key||f.dataIndex,i),readonly:f.readonly||m,tooltip:f.tooltip||f.tip,getFieldProps:f.fieldProps?function(){return(0,je.h)(f.fieldProps,l,f)}:void 0,getFormItemProps:f.formItemProps?function(){return(0,je.h)(d()({labelCol:o},f.formItemProps),l,f)}:function(){return{labelCol:o}}})),R=b.key||((F=b.dataIndex)===null||F===void 0?void 0:F.toString())||h;b.key=R,b.name=b.name||b.dataIndex;var x=(0,En.E)(b,{action:void 0,type:"form",originItem:f,formRef:{current:l},genItems:function(T){return r(T,a,l,{labelCol:o,valueBaseName:i,colProps:u,readonly:m})}});return x}).filter(function(f){return!!f})},Nn=["embed","readonly","submitter","columns","valueBaseName","initialValues","formRef","onFinish","innerRef"],kn=function(t){var a=t.embed,l=a===void 0?!1:a,e=t.readonly,n=t.submitter,o=n===void 0?!1:n,i=t.columns,s=i===void 0?[]:i,u=t.valueBaseName,c=t.initialValues,m=t.formRef,f=t.onFinish,h=t.innerRef,F=E()(t,Nn),y=(0,S.useRef)(),C=(0,S.useRef)(Oe()),b=(0,S.useContext)(Ye),R=function(){return b||h||y};(0,S.useEffect)(function(){var K=R();K.current||(K.current=C.current),K.current.data||(K.current.data=C.current.data),K.current.setData||(K.current.setData=C.current.setData)},[]);var x=Fe.Z.useForm(),O=q()(x,1),T=O[0],j=Fe.Z.useFormInstance(),I=(0,S.useRef)(t.form||j||T),M=(0,S.useRef)(),V=(0,S.useRef)(void 0),Z=(0,S.useState)(1),D=q()(Z,2),L=D[0],z=D[1];(0,S.useEffect)(function(){if(!l&&I.current){var K=I.current,U=K.getFieldsValue,H=K.setFieldsValue;I.current=d()(d()({},I.current),{},{setFieldsValue:function($){var w;Ie($,{getFieldsValue:U,setFieldsValue:H}),(w=R().current)===null||w===void 0||w.setData($||{})}}),c?Ie(c,{getFieldsValue:U,setFieldsValue:H,callback:function($){V.current=$,z(function(w){return w+1})}}):z(function(Y){return Y+1})}},[l]),(0,S.useImperativeHandle)(m,function(){if(M.current){var K=M.current,U=K.getFieldsValue,H=K.validateFields,Y=K.getFieldsFormatValue,$=K.validateFieldsReturnFormatValue;return d()(d()({},M.current),{},{getFieldsValue:function(){return ne(U.apply(void 0,arguments))},getFieldsFormatValue:Y?function(w){return ne(Y(w))}:void 0,validateFields:function(){return H.apply(void 0,arguments).then(function(N){return ne(N)})},validateFieldsReturnFormatValue:$?function(w){return $(w).then(function(N){return ne(N)})}:void 0})}},[L]);var _=(0,S.useContext)(Xe)||{},ee=function(){var K=Ke()(ce()().mark(function U(H){return ce()().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(!f){$.next=2;break}return $.abrupt("return",f(ne(H)));case 2:case"end":return $.stop()}},U)}));return function(H){return K.apply(this,arguments)}}(),Q=function K(U){var H=R();return(0,Ae.produce)(U,function(Y){Y.forEach(function($){var w=$.renderFormItem,N=$.fieldProps,Cn=$.valueType,he=$.columns,ke=$.formItemProps,xe=ke===void 0?{}:ke,Ze=$.required,Ve=$.render;if(Ze)if(typeof xe=="function")$.formItemProps=function(le,de){var k=xe(le,de);return k.rules||(k.rules=[]),k.rules.push({required:!0}),k};else{var Se=xe||{};Se.rules||(Se.rules=[]),Se.rules.push({required:!0}),$.formItemProps=Se}N&&typeof N=="function"&&($.fieldProps=function(le,de){return N(le,H,de)}),w&&($.renderFormItem=function(le,de,k){return w(le,de,k,H)}),Ve&&($.render=function(le,de){for(var k,G,De,He=((k=M.current)===null||k===void 0||(G=k.getFieldsFormatValue)===null||G===void 0?void 0:G.call(k))||{},We=((De=R().current)===null||De===void 0?void 0:De.data)||{},fe=arguments.length,ge=new Array(fe>2?fe-2:0),we=2;we<fe;we++)ge[we-2]=arguments[we];return Ve.apply(void 0,[le,d()(d()(d()(d()({},de),c||{}),We),ne(He))].concat(ge))}),he&&Array.isArray(he)&&($.columns=K(he)),Cn==="dependency"&&he&&typeof he=="function"&&($.columns=function(le){return K(he(le))})})})};if(l){var X=t.grid,ae=t.rowProps,ue=t.colProps,oe=t.labelCol,ie=(0,S.useContext)(Ge),A=e===void 0?ie:e;return X?(0,P.jsx)(Mn._p.Provider,{value:{grid:!0,colProps:ue},children:(0,P.jsx)(wn.Z,d()(d()({},ae),{},{children:_e(Q(s),"form",j,{labelCol:oe,valueBaseName:u,colProps:ue,readonly:A})}))}):_e(Q(s),"form",j,{labelCol:oe,valueBaseName:u,readonly:A})}var W=function(){if(Ce()(o)==="object"){var U=o.render,H=o.style,Y=H===void 0?{}:H;return U||(o.render=function($,w){return(0,P.jsx)("div",{style:d()({display:"flex",alignItems:"center",gap:"8px"},Y),children:w})}),o}return o};return(0,P.jsx)(Vn.Z,d()(d()(d()({},_),{},{onFinish:ee,submitter:W(),readonly:e,initialValues:V.current,formRef:M},F),{},{form:I.current,columns:Q(s),layoutType:"Form"}),L)},en=kn,mr=function(){return null},Zn=v(12444),Pe=v.n(Zn),Hn=v(72004),be=v.n(Hn),Wn=v(25098),g=v.n(Wn),zn=v(31996),Re=v.n(zn),Yn=v(26037),Te=v.n(Yn),Ue=v(85576),nn=v(73505),Gn=v(70942);function te(r,t){typeof window!="undefined"?(window[r]||(window[r]={}),window[r]=d()(d()({},window[r]),t)):(v.g[r]||(v.g[r]={}),v.g[r]=d()(d()({},v.g[r]),t))}function B(){for(var r=typeof window!="undefined"?window:v.g,t=0;t<arguments.length;t++){var a=t<0||arguments.length<=t?void 0:arguments[t];if(!r[a])return;r=r[a]}return r}function se(){for(var r=typeof window!="undefined"?window:v.g,t=0;t<arguments.length;t++){var a=t<0||arguments.length<=t?void 0:arguments[t];if(!r[a])return;t===arguments.length-1&&delete r[a],r=r[a]}}var me=Gn.bind({ignoreUndefined:!0});function Be(r){if(Ce()(r)!=="object"||r===null)return!1;var t=Object.getPrototypeOf(r);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}var Jn=function(t,a,l){var e=t||l;if(a===!1)return!1;if(a===void 0)return t||l;if(Be(a)&&!Be(e))return a;if(Be(a)&&Be(e))return me(e,a)},Qn=function(t,a,l){return(0,nn.Z)(a)?a:(0,nn.Z)(t)?t:l},Xn=["children"];function tn(r){return cloneDeepWith(r,function(t){if(isElement(t)||isValidElement(t))return!0})}function rn(r,t,a){var l=a||{},e=l.replace,n=t?t(r)||{}:{},o=e?d()({},n):d()(d()({},r),n);if(!o.children){var i=o.children,s=E()(o,Xn);return s}return d()(d()({},o),{},{children:o.children?o.children.map(function(u){return rn(u,t,a)}):[]})}function an(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,l=a||{},e=l.replace,n=e===void 0?!1:e;return r.map(function(o){return rn(o,t,{replace:n})})}function qn(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=a===0?tn(r):r,e=[];return l.forEach(function(n){var o=t(n);if(o)return o&&n.children&&(n.children=qn(n.children,t,a+1)),e.push(n)}),e}function _n(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,e,n=l===0?tn(r):r,o=0;o<n.length;o++){var i=n[o],s=et(i,t,a,l);if(s){e=s;break}else a.splice(l)}return l>0?e:a}function et(r,t,a,l){if(a.push(r),t(r))return r;if(r.children&&r.children.length)return _n(r.children,t,a,l+1)}var nt=["columns","onFinish","onCancel","formProps","innerRef","open"],tt=["width"],rt=["isKeyPressSubmit","autoFocusFirstInput","initialValues","form","formRef"],at=["styles"],on=function(r){Re()(a,r);var t=Te()(a);function a(l){var e,n;Pe()(this,a),n=t.call(this,l),p()(g()(n),"selfFormRef",void 0),p()(g()(n),"selfInnerRef",void 0),p()(g()(n),"baseInnerObj",void 0),p()(g()(n),"context",void 0),p()(g()(n),"componentDidUpdate",function(){var i=Ke()(ce()().mark(function s(u,c){return ce()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(!u.open&&n.props.open)){f.next=6;break}if(!n.props.onOpen){f.next=6;break}return n.setState({loading:!0}),f.next=5,n.props.onOpen(n.state.formType,n.getFormRef(),n.state.formData);case 5:n.setState({loading:!1});case 6:if(!(!c.visible&&n.state.visible)){f.next=12;break}if(!n.props.onOpen){f.next=12;break}return n.setState({loading:!0}),f.next=11,n.props.onOpen(n.state.formType,n.getFormRef(),n.state.formData);case 11:n.setState({loading:!1});case 12:case"end":return f.stop()}},s)}));return function(s,u){return i.apply(this,arguments)}}()),p()(g()(n),"getFormRef",function(){var i;return((i=n.props.formProps)===null||i===void 0?void 0:i.formRef)||n.selfFormRef}),p()(g()(n),"getInnerRef",function(){return n.props.innerRef||n.selfInnerRef}),p()(g()(n),"openModal",function(){var i,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"new",u=arguments.length>1?arguments[1]:void 0,c=n.getInnerRef();if(c.current.formType=s,u){n.setState({visible:!0,formType:s,formData:u});return}n.setState({visible:!0,formType:s,formData:((i=n.props.formProps)===null||i===void 0?void 0:i.initialValues)||{}})}),p()(g()(n),"onOk",function(){if(n.getFormRef().current){var i=n.getFormRef().current.submit;i()}}),p()(g()(n),"onFinish",function(){var i=Ke()(ce()().mark(function s(u){var c,m,f,h;return ce()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(c=n.props.onFinish,m=n.state,f=m.formType,h=m.formData,n.setState({loading:!0}),!c){y.next=15;break}return y.prev=4,y.next=7,c(u,f,h);case 7:n.setState({loading:!1}),n.getOnCancel(),y.next=15;break;case 11:y.prev=11,y.t0=y.catch(4),console.log("onFinishError",y.t0),n.setState({loading:!1});case 15:case"end":return y.stop()}},s,null,[[4,11]])}));return function(s){return i.apply(this,arguments)}}()),p()(g()(n),"handleOnCancel",function(){var i,s=n.props,u=s.getContainer,c=s.confirmOnClose,m=c===void 0?!0:c,f=(i=n.getFormRef().current)===null||i===void 0?void 0:i.isFieldsTouched();m&&f?Ue.Z.confirm({title:"\u786E\u8BA4\u5173\u95ED\u5F39\u7A97\u5417?",content:"\u5173\u95ED\u5F39\u7A97\u540E\u60A8\u6240\u66F4\u6539\u7684\u5185\u5BB9\u5C06\u4E0D\u4F1A\u4FDD\u5B58!",centered:!0,closable:!0,onOk:function(){n.getOnCancel()},getContainer:u}):n.getOnCancel()}),p()(g()(n),"getOnCancel",function(){var i=n.props,s=i.onCancel,u=i.open;u?s&&s():n.setState({visible:!1})}),p()(g()(n),"getModalProps",function(){var i=n.props,s=i.columns,u=i.onFinish,c=i.onCancel,m=i.formProps,f=i.innerRef,h=i.open,F=E()(i,nt),y=n.context||{},C=y.modalProps,b=C===void 0?{}:C;return me(b,F)}),p()(g()(n),"getStylesProps",function(){var i=n.getModalProps(),s=i.styles;return me({body:{maxHeight:"calc(100vh - 108px - 100px - 25px)",overflow:"auto",marginRight:"-20px",paddingRight:"20px"}},s)}),p()(g()(n),"getColumns",function(){var i=an(n.props.columns,function(s){var u=s.width,c=E()(s,tt);return c},{replace:!0});return i}),n.state={visible:!1,formData:((e=l.formProps)===null||e===void 0?void 0:e.initialValues)||{},formType:"new",loading:!1},n.selfInnerRef=(0,S.createRef)(),n.selfFormRef=(0,S.createRef)(),n.baseInnerObj=Oe();var o=n.getInnerRef();return o.current||(o.current={}),o.current.openModal=n.openModal,o.current.data||(o.current.data=n.baseInnerObj.data),o.current.setData||(o.current.setData=n.baseInnerObj.setData),n}return be()(a,[{key:"render",value:function(){var e=this.state.formType,n=this.props,o=n.formProps,i=n.open,s=o||{},u=s.isKeyPressSubmit,c=u===void 0?!0:u,m=s.autoFocusFirstInput,f=m===void 0?!0:m,h=s.initialValues,F=s.form,y=s.formRef,C=E()(s,rt),b=this.context||{},R=b.formProps,x=R===void 0?{}:R,O=me(x,C),T=this.getModalProps(),j=T.styles,I=E()(T,at);return(0,P.jsx)(Ue.Z,d()(d()({destroyOnClose:!0,open:i||this.state.visible,styles:this.getStylesProps()},I),{},{onCancel:this.handleOnCancel,onOk:this.onOk,okButtonProps:{loading:this.state.loading},children:(0,P.jsx)(ot,{columns:this.getColumns(),onFinish:this.onFinish,formRest:d()(d()({autoFocusFirstInput:f,isKeyPressSubmit:c,initialValues:i?h:d()({},this.state.formData),readonly:e==="read"},O),{},{formRef:this.getFormRef(),innerRef:this.getInnerRef()})})}))}}]),a}(S.Component);p()(on,"contextType",Qe);var ot=function(t){var a=Fe.Z.useForm(),l=q()(a,1),e=l[0],n=t.formProps,o=t.columns,i=t.onFinish,s=t.formRest;return(0,P.jsx)(en,d()(d()({scrollToFirstError:!0,columns:o,onFinish:i},s),{},{form:(n==null?void 0:n.form)||e}))},ln=on,hr=function(){return null},it=v(81555),sn=v(42075),un=v(86738),lt=v(45360),st=v(28036),ut=["visible"],dt=function(t){var a=t.visible,l=a===void 0?!0:a,e=E()(t,ut);return typeof l=="function"&&!l()||!l?null:(0,P.jsx)(st.ZP,d()({},e))},dn=dt,gr=function(){return null},yr=v(97560),ft=["className"],ct=function(t){var a=t.className,l=E()(t,ft);return(0,P.jsx)(dn,d()(d()({className:"rak-link-btn "+(a||"")},l),{},{type:"link"}))},ye=ct,pt=null,vt=function(t){return t.filter(function(a){return!a.hideInTable}).filter(function(a){var l=typeof a.valueType=="string"?a.valueType:"";return!["option","index"].includes(l)})},Sr=function(t){return t.filter(function(a){return!a.hideInSearch}).filter(function(a){var l=typeof a.valueType=="string"?a.valueType:"";return!["option","index"].includes(l)}).map(function(a){var l=a.hideInForm,e=a.formItemProps,n=_objectWithoutProperties(a,pt);return n})},Fr=function(t){return t.filter(function(a){return!a.hideInForm}).filter(function(a){var l=typeof a.valueType=="string"?a.valueType:"";return!["option","index"].includes(l)})},Cr=function(t){return t.filter(function(a){return!a.hideInTable})},Pr=function(t){var a={};return t.filter(function(l){return l.sorter===!0}).forEach(function(l){var e=l.defaultSortOrder||"descend";a[l.dataIndex]=e}),a},fn=function(t,a){if(Object.keys(a).length<1)return t;var l={ascend:"asc",descend:"desc"},e=Object.keys(a)[0],n={sort:"".concat(e,",").concat(l[a[e]])};return d()(d()({},t),n)},br=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"asc",l={asc:"ascend",desc:"descend"},e=a==="asc"?["ascend","descend","ascend"]:["descend","ascend","descend"];return{defaultSortOrder:l[a],sortDirections:e,sorter:!0}},mt=v(93967),ht=v.n(mt),gt=v(12823),yt=v(93162),St=v(30381),Ft=v.n(St),Ct=20;function Le(r,t){return r?typeof r=="string"?r:Ft()(r).format(t):""}function Pt(r,t){if(t.valueEnum){var a;return(a=t.valueEnum[r])===null||a===void 0?void 0:a.text}if(t.fieldProps)if(typeof t.fieldProps=="function"){var l,e,n=((l=t.fieldProps({},{current:{}},t))===null||l===void 0?void 0:l.options)||[];return(e=n.find(function(u){return u.value==r}))===null||e===void 0?void 0:e.label}else{var o,i,s=((o=t.fieldProps)===null||o===void 0?void 0:o.options)||[];return(i=s.find(function(u){return u.value==r}))===null||i===void 0?void 0:i.label}}function bt(r,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=typeof t.dataIndex=="string"?r[t.dataIndex]:"";return t.renderExport?t.renderExport(l,r):t.render?t.render(l,r,a,void 0,void 0):t.renderText?t.renderText(l,r,a):["select","radio","radioButton","checkbox"].includes(t.valueType||"")?Pt(l,t):t.valueType==="date"?Le(l,"YYYY-MM-DD"):t.valueType==="dateTime"?Le(l,"YYYY-MM-DD HH:mm:ss"):t.valueType==="dateRange"&&l?l.map(function(e){return Le(e,"YYYY-MM-DD")}).join(" - "):t.valueType==="dateTimeRange"&&l?l.map(function(e){return Le(e,"YYYY-MM-DD HH:mm:ss")}).join(" - "):t.valueType==="money"?l||"":l&&Ce()(l)==="object"?l.value:l}function Rt(r,t){r.xlsx.writeBuffer().then(function(a){var l=new Blob([a],{type:""});(0,yt.saveAs)(l,t)})}var Tt=function(t,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"\u9ED8\u8BA4\u5BFC\u51FA",e=new gt.Workbook,n=e.addWorksheet("sheet1");n.properties.defaultRowHeight=20,n.columns=t.map(function(i){return{header:typeof i.title=="string"?i.title:"",key:typeof i.dataIndex=="string"?i.dataIndex:Date.now().toString(),width:i.width?Number(i.width)/5:Ct}}),n.columns.forEach(function(i){i.alignment={vertical:"middle"}}),console.log("\u5BFC\u51FA",a);var o=(a||[]).map(function(i,s){return t.map(function(u){return bt(i,u,s)})});n.addRows(o),(a||[]).forEach(function(i,s){t.forEach(function(u,c){var m=u.onCell?u.onCell(i)||{}:{},f=m.rowSpan;if(f>1){var h=s+2,F=c+1;n.mergeCells(h,F,h+f-1,F)}})}),Rt(e,l+".xlsx")},$t=["children","title","content","onOk"],xt=Ue.Z.confirm,Dt=function(t){var a=t.children,l=t.title,e=t.content,n=t.onOk,o=E()(t,$t),i=function(u){u.stopPropagation(),xt(d()({title:l,content:e,onOk:n},o))};return S.cloneElement(a,{onClick:i})},cn=Dt,Rr=v(59700),Kt=["title"],It=["btnText","title"],Ot=["rowKey","name","columns","options","pagination","formColumns","scroll","onFinish","tableAlertOption","rowSelection","sticky","className","optionColSpaceSize","noPadding","search","request","onOpen","modalProps","formProps","defaultHideInSearch","confirmModalProps","confirmModelType","optionColumnSpaceProps","actionRef"],jt=["modalProps","formProps","searchConfig","options","defaultHideInSearch","confirmModalType","confirmModalProps","tableAlertOption"],Bt={new:"\u65B0\u589E",edit:"\u7F16\u8F91",read:"\u67E5\u770B"},pn=function(r){Re()(a,r);var t=Te()(a);function a(l){var e;return Pe()(this,a),e=t.call(this,l),p()(g()(e),"targetId",void 0),p()(g()(e),"selfInnerRef",void 0),p()(g()(e),"selfActionRef",void 0),p()(g()(e),"baseInnerObj",void 0),p()(g()(e),"context",void 0),p()(g()(e),"tableReload",function(){var n,o=e.props.actionRef||e.selfActionRef;(n=o.current)===null||n===void 0||n.reload()}),p()(g()(e),"getInnerRef",function(){return e.props.innerRef||e.selfInnerRef}),p()(g()(e),"getTitle",function(){var n=e.props,o=n.name,i=n.toolbar,s=i===void 0?{}:i,u=s.title;return u||(o?"".concat(o,"\u5217\u8868"):!1)}),p()(g()(e),"getModalTitle",function(){var n=e.props.name,o=n===void 0?"":n,i=e.state.formType;return"".concat(Bt[i]).concat(o)||""}),p()(g()(e),"patchColumn",function(n){var o=e.context||{},i=o.optionColumnSpaceProps,s=e.props.optionColumnSpaceProps,u=s===void 0?{}:s,c=e.getInnerRef(),m=me({size:"small"},i,u);return(0,Ae.default)(n,function(f){f.forEach(function(h){var F=h.render;h.valueType==="option"&&F&&(h.render=function(y,C,b,R){var x=F(y,C,b,R,c);return Array.isArray(x)?(0,P.jsx)(sn.Z,d()(d()({},m),{},{children:x})):x})})})}),p()(g()(e),"enableDelete",function(n){var o=e.context||{},i=o.confirmModalType,s=o.confirmModalProps,u=e.props,c=u.rowKey,m=c===void 0?"id":c,f=u.delPermission,h=u.delFunction,F=u.confirmModelType,y=F===void 0?i||"popconfirm":F,C=u.confirmModalProps,b=C===void 0?{}:C,R=me(s,b),x=f?f():!0,O=e.state.delLoading;return(0,Ae.default)(n,function(T){T.forEach(function(j){var I=j.render,M=j.enableDelete,V=M===void 0?!1:M;j.valueType==="option"&&h&&x&&V&&I&&(j.render=function(Z,D,L,z,_){var ee=typeof m=="function"?m(D):m,Q=typeof V=="function"?V(D,L):{},X=Q.disabled,ae=X===void 0?!1:X,ue=Q.visible,oe=ue===void 0?!0:ue,ie=Q.danger,A=Q.btnText,W=A===void 0?"\u5220\u9664":A,K=I(Z,D,L,z,_);if(Array.isArray(K)&&oe){var U,H=R.title,Y=H===void 0?"\u786E\u5B9A\u5220\u9664\u5417?":H,$=E()(R,Kt);y==="modal"?U=(0,P.jsx)(cn,d()(d()({title:Y},$),{},{onOk:function(){e.handleDelete([D[ee]],D)},children:(0,P.jsx)(ye,{disabled:ae,onClick:function(N){return N.stopPropagation()},loading:O&&D[ee]===e.targetId,danger:ie,children:W})}),K.length+1):U=(0,P.jsx)(un.Z,d()(d()({title:Y},$),{},{onConfirm:function(N){N==null||N.stopPropagation(),e.handleDelete([D[ee]],D)},onCancel:function(N){return N==null?void 0:N.stopPropagation()},children:(0,P.jsx)(ye,{disabled:ae,onClick:function(N){return N.stopPropagation()},loading:O&&D[ee]===e.targetId,danger:ie,children:W})}),K.length+1),K.push(U)}return K})})})}),p()(g()(e),"getRowSelection",function(){var n=e.props.rowSelection,o=e.state.selectedRowKeys;return n&&!n.selectedRowKeys?d()(d()({},n),{},{selectedRowKeys:o,onChange:function(s,u){return e.setState({selectedRowKeys:s,selectedRows:u})}}):n}),p()(g()(e),"handleDelete",function(n,o,i){var s=e.props,u=s.rowKey,c=u===void 0?"id":u,m=s.delFunction,f=s.rowSelection,h=f===void 0?{}:f,F=s.actionRef,y=F===void 0?e.selfActionRef:F,C=typeof c=="function"?c(o):c;e.setState({delLoading:!0}),o[C]&&(e.targetId=o[C]),m&&m(n,o).then(function(){if(lt.ZP.success("\u5220\u9664\u6210\u529F!"),i&&i(),o[C]&&h){var b=(n||[]).filter(function(V){return V!==o[C]});h.selectedRowKeys?h.onChange&&h.onChange(b):e.setState({selectedRowKeys:b})}var R=y.current;if(R){var x=R.pageInfo,O=x.current,T=x.total,j=x.pageSize,I=o.id?1:(n||[]).length,M=T-I===(O-1)*j;if(O>1&&M){R.setPageInfo({current:O-1});return}R.reload()}}).finally(function(){e.setState({delLoading:!1})})}),p()(g()(e),"tableAlertOptionRender",function(n){var o=n.selectedRowKeys,i=n.onCleanSelected,s=e.state,u=s.delLoading,c=s.selectedRows,m=e.context||{},f=m.tableAlertOption,h=e.props,F=h.tableAlertOption,y=F===void 0?{}:F,C=h.columns,b=h.name,R=h.delFunction,x=h.delPermission,O=h.confirmModelType,T=me(f,y),j=T.hideDelete,I=j===void 0?!1:j,M=T.enableExport,V=M===void 0?!1:M,Z=T.actions,D=Z===void 0?[]:Z,L=T.exportName,z=T.deleteProps,_=z||{},ee=_.btnText,Q=ee===void 0?"\u6279\u91CF\u5220\u9664":ee,X=_.title,ae=E()(_,It),ue=x?x():!0,oe=function(){if(!I&&R&&ue){var A=X?X(o.length):"\u786E\u5B9A\u5220\u9664".concat(o.length,"\u6761\u6570\u636E\u5417?");return O==="modal"?(0,P.jsx)(cn,d()(d()({title:A},ae),{},{onOk:function(){e.handleDelete(o,{},i)},okButtonProps:{loading:u},children:(0,P.jsx)(ye,{loading:u,children:Q})})):(0,P.jsx)(un.Z,d()(d()({overlayStyle:{width:"180px"},title:A},ae),{},{onConfirm:function(){e.handleDelete(o,{},i)},okButtonProps:{loading:u},children:(0,P.jsx)(ye,{loading:u,children:Q})}))}};return(0,P.jsxs)(sn.Z,{size:"middle",children:[V&&(0,P.jsx)(ye,{onClick:function(){Tt(vt(C),c,L||"".concat(b?b+"\u5217\u8868":"","\u5BFC\u51FA")),i()},children:"\u5BFC\u51FA\u6240\u9009"}),oe(),D,(0,P.jsx)("a",{onClick:i,children:"\u53D6\u6D88\u9009\u62E9"})]})}),p()(g()(e),"selfOnOpen",function(n,o,i){e.setState({formType:n}),e.props.onOpen&&e.props.onOpen(n,o,i)}),e.state={formType:"",delLoading:!1,selectedRowKeys:[],selectedRows:[]},e.targetId="",e.selfInnerRef=(0,S.createRef)(),e.selfActionRef=(0,S.createRef)(),e.baseInnerObj=Oe(),e.getInnerRef().current={},e.getInnerRef().current.data=e.baseInnerObj.data,e.getInnerRef().current.setData=e.baseInnerObj.setData,e}return be()(a,[{key:"componentDidMount",value:function(){document.addEventListener("reload",this.tableReload)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("reload",this.tableReload)}},{key:"render",value:function(){var e=this,n=this.props,o=n.rowKey,i=o===void 0?"id":o,s=n.name,u=n.columns,c=n.options,m=n.pagination,f=m===void 0?{}:m,h=n.formColumns,F=n.scroll,y=F===void 0?{x:"100%"}:F,C=n.onFinish,b=n.tableAlertOption,R=n.rowSelection,x=n.sticky,O=x===void 0?!0:x,T=n.className,j=n.optionColSpaceSize,I=n.noPadding,M=I===void 0?!1:I,V=n.search,Z=n.request,D=n.onOpen,L=n.modalProps,z=L===void 0?{}:L,_=n.formProps,ee=_===void 0?{}:_,Q=n.defaultHideInSearch,X=n.confirmModalProps,ae=n.confirmModelType,ue=n.optionColumnSpaceProps,oe=n.actionRef,ie=E()(n,Ot),A=this.context||{},W=A.modalProps,K=W===void 0?{}:W,U=A.formProps,H=U===void 0?{}:U,Y=A.searchConfig,$=Y===void 0?{}:Y,w=A.options,N=A.defaultHideInSearch,Cn=A.confirmModalType,he=A.confirmModalProps,ke=A.tableAlertOption,xe=E()(A,jt),Ze=d()(d()({},xe),ie),Ve=d()(d()({},K),z),Se=d()(d()({},$),{},{className:"searchFormStyleFix"}),le=Jn(w,c,!1),de=Qn(N,Q,!1);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(it.ZP,d()({className:ht()(T,j==="small"&&"myTableSmallOptionCol",M&&"rak-protable-no-padding"),rowKey:i,headerTitle:this.getTitle(),columns:this.patchColumn(this.enableDelete(an(u,function(k){var G=d()({},k);return G.hideInSearch===void 0&&(G.hideInSearch=de),(G.type==="search"||G.valueType==="dependency")&&(G.search=!0,G.hideInSearch=!1,G.hideInTable=!0,G.hideInForm=!0),G}))).filter(function(k){return k.type!=="form"}),options:le,pagination:f,scroll:y,tableAlertOptionRender:this.tableAlertOptionRender,rowSelection:this.getRowSelection(),sticky:O,search:V===!1?!1:d()(d()({},Se),V),request:Z?function(k,G,De){return new Promise(function(He,We){Z(fn(k,G),G,De).then(function(fe){var ge=e.getInnerRef();ge&&(ge.current.total=fe.total,ge.current.dataSource=fe.data,ge.current.params=fn(k,G)),He(fe)}).catch(function(fe){return We(fe)})})}:void 0,actionRef:oe||this.selfActionRef},Ze)),(0,P.jsx)(ln,d()({innerRef:this.getInnerRef(),title:this.getModalTitle(),columns:(h||u).filter(function(k){return k.type==="form"||!k.type}),onFinish:C,onOpen:this.selfOnOpen,formProps:d()(d()({},H),ee)},Ve))]})}}]),a}(S.Component);p()(pn,"contextType",Je);var Lt=pn,vn=v(34041),Ne=v(35322),Mt=v(36409);function mn(r,t,a,l){var e=l||{},n=e.parentKey,o=e.icon,i=e.isTop;return r.children?_objectSpread(_objectSpread({},r),{},{key:r[a],title:r[t],nodeId:n,isTop:i,icon:o,children:r.children.map(function(s){return mn(s,t,a,{parentKey:r[a],icon:o})})}):_objectSpread(_objectSpread({},r),{},{key:r[a],title:r[t],nodeId:n,isTop:i})}function Tr(r,t){var a=t||{},l=a.titleKey,e=l===void 0?"title":l,n=a.valueKey,o=n===void 0?"id":n,i=a.icon;return r.map(function(s){return mn(s,e,o,{parentKey:"",icon:i||s.icon,isTop:!0})})}function hn(r,t,a){return r.children?d()(d()({},r),{},{value:r[a],title:r[t],children:r.children.map(function(l){return hn(l,t,a)})}):d()(d()({},r),{},{value:r[a],title:r[t]})}function Me(r,t){var a=t||{},l=a.titleKey,e=l===void 0?"label":l,n=a.valueKey,o=n===void 0?"id":n;return r.map(function(i){return hn(i,e,o)})}function gn(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=t||{},l=a.labelKey,e=l===void 0?"name":l,n=a.valueKey,o=n===void 0?"id":n,i=a.renderLabel;return r.map(function(s){var u=s.disabled,c=s.title,m=s.options,f=s.className,h;return i?h=i(s):h=s[e],{label:h,value:s[o],disabled:u,title:c,options:m,className:f}})}function yn(r,t){return r.children?d()(d()({},r),{},{disabled:t&&t(r),children:r.children.map(function(a){return yn(a,t)})}):d()(d()({},r),{},{disabled:t&&t(r)})}function Vt(r,t){return t?r.map(function(a){return yn(a,t)}):r}function Sn(r,t){return r.children?_objectSpread(_objectSpread({},r),{},{checkable:t&&t(r),children:r.children.map(function(a){return Sn(a,t)})}):_objectSpread(_objectSpread({},r),{},{checkable:t&&t(r)})}function $r(r,t){return t?r.map(function(a){return Sn(a,t)}):r}function wt(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"id",l,e=0;e<r.length;e++){var n=Et(r[e],t,a);if(n){l=n;break}}return l}function Et(r,t,a){if(r[a]===t)return r;if(r.children&&r.children.length)return wt(r.children,t,a)}var At=["type","loadFunction","labelKey","valueKey","renderLabel","onChange","queryParams","noCache","showSearch","optionFilterProp","allowClear","searchDebounceValue"],Ut=function(r){Re()(a,r);var t=Te()(a);function a(l){var e;return Pe()(this,a),e=t.call(this,l),p()(g()(e),"reRender",function(n){n.detail.type===e.props.type&&!e.isNoCache()&&(e.setState({loading:!1,dataSource:B(J,e.props.type)||[],total:B(re,e.props.type)||0}),e.props.onLoad&&e.props.onLoad(B(J,e.props.type)||[],B(re,e.props.type)||0),te(pe,p()({},e.props.type,!1)))}),p()(g()(e),"isNoCache",function(){var n=e.props,o=n.queryParams,i=o===void 0?{}:o,s=n.noCache;return Object.keys(i).length>0||s}),p()(g()(e),"handleLoadData",function(){e.isNoCache()?e.loadDataWithoutCache():e.loadDataForCache()}),p()(g()(e),"loadDataForCache",function(){var n=e.props,o=n.type,i=n.loadFunction,s=n.onLoad;if(B(pe,o)){e.setState({loading:!0});return}if(B(J,o)){s&&s(B(J,o)||[],B(re,o));return}te(pe,p()({},o,!0)),e.setState({loading:!0}),i({}).then(function(u){te(J,p()({},o,u.data)),te(re,p()({},o,u.total)),s&&s(u.data,u.total);var c=new CustomEvent("selectGlobalUpdate",{detail:{type:o}});document.dispatchEvent(c)}).finally(function(){e.setState({loading:!1})})}),p()(g()(e),"loadDataWithoutCache",function(){var n=e.props,o=n.loadFunction,i=n.queryParams,s=i===void 0?{}:i,u=n.onLoad;e.setState({loading:!0}),o(s).then(function(c){e.setState({dataSource:c.data,total:c.total}),u&&u(c.data,c.total)}).finally(function(){e.setState({loading:!1})})}),p()(g()(e),"getTotal",function(){return e.isNoCache()?e.state.total:B(re,e.props.type)}),p()(g()(e),"reset",function(){var n=e.props.type;e.setState({searchValue:void 0,dataSource:B(J,n)||[],total:B(re,n),current:1}),e.isNoCache()&&e.handleLoadData()}),p()(g()(e),"handleOnChange",function(n){var o=e.props,i=o.onChange,s=o.valueKey,u=s===void 0?"id":s,c=o.labelInValue;if(!n){e.reset(),i&&i(n,{});return}n&&e.state.searchValue&&e.reset(),i&&i(n,e.state.dataSource.find(function(m){return c?m[u]===(n==null?void 0:n.value):m[u]===n}))}),p()(g()(e),"handleUpdateData",function(){var n=e.state,o=n.current,i=n.searchValue,s=n.dataSource,u=e.props.queryParams,c=u===void 0?{}:u;e.setState({loading:!0}),e.props.loadFunction(d()(d()({},c),{},{current:o,searchValue:i})).then(function(m){e.setState({dataSource:s.concat(m.data),loading:!1,total:m.total}),i||te(J,p()({},e.props.type,s.concat(m.data)))})}),p()(g()(e),"handleSearchData",function(){var n=e.state.searchValue,o=e.props.queryParams,i=o===void 0?{}:o;e.setState({loading:!0}),e.props.loadFunction(d()(d()({},i),{},{current:1,searchValue:n})).then(function(s){e.setState({dataSource:s.data,loading:!1,total:s.total})})}),p()(g()(e),"handlePopupScroll",function(n){n.persist();var o=n.target,i=e.state.current;e.toBottomNeedLoad(o)&&e.setState({current:i+1},e.handleUpdateData)}),p()(g()(e),"toBottomNeedLoad",function(n){var o=e.state,i=o.dataSource,s=o.loading;return!s&&e.toBottom(n)&&i.length<e.getTotal()}),p()(g()(e),"toBottom",function(n){return n.scrollTop+n.clientHeight+10>n.scrollHeight}),p()(g()(e),"handleSearch",function(n){if(n){e.setState({searchValue:n,current:1},function(){return e.handleSearchData()});return}e.reset()}),e.state={dataSource:B(J,l.type)||[],total:B(re,l.type)||0,loading:!1,searchValue:"",current:1},e}return be()(a,[{key:"componentDidMount",value:function(){this.handleLoadData(),document.addEventListener("selectGlobalUpdate",this.reRender)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("selectGlobalUpdate",this.reRender)}},{key:"componentDidUpdate",value:function(e){(0,Ne.Z)(e.queryParams,this.props.queryParams)||this.handleLoadData()}},{key:"render",value:function(){var e=this.props,n=e.type,o=e.loadFunction,i=e.labelKey,s=i===void 0?"name":i,u=e.valueKey,c=u===void 0?"id":u,m=e.renderLabel,f=e.onChange,h=e.queryParams,F=e.noCache,y=e.showSearch,C=e.optionFilterProp,b=e.allowClear,R=e.searchDebounceValue,x=R===void 0?300:R,O=E()(e,At),T=y!==void 0?y:!0,j=b!==void 0?b:!0;return(0,P.jsx)(vn.default,d()(d()({},O),{},{loading:this.state.loading,onChange:this.handleOnChange,options:gn(this.state.dataSource,{labelKey:s,valueKey:c,renderLabel:m}),showSearch:T,allowClear:j&&!this.state.loading,filterOption:!1,onPopupScroll:this.handlePopupScroll,onSearch:(0,Mt.Z)(this.handleSearch,x)}))}}]),a}(S.Component),Nt=Ut,kt=["type","loadFunction","labelKey","valueKey","renderLabel","onChange","queryParams","noCache","showSearch","optionFilterProp","allowClear"],Zt=function(r){Re()(a,r);var t=Te()(a);function a(l){var e;return Pe()(this,a),e=t.call(this,l),p()(g()(e),"reRender",function(n){n.detail.type===e.props.type&&!e.isNoCache()&&(e.setState({loading:!1,dataSource:B(J,e.props.type)||[],total:B(re,e.props.type)||0}),e.props.onLoad&&e.props.onLoad(B(J,e.props.type)||[],B(re,e.props.type)||0),te(pe,p()({},e.props.type,!1)))}),p()(g()(e),"isNoCache",function(){var n=e.props,o=n.queryParams,i=o===void 0?{}:o,s=n.noCache;return Object.keys(i).length>0||s}),p()(g()(e),"handleLoadData",function(){e.isNoCache()?e.loadDataWithoutCache():e.loadDataForCache()}),p()(g()(e),"loadDataForCache",function(){var n=e.props,o=n.type,i=n.loadFunction,s=n.onLoad;if(B(pe,o)){e.setState({loading:!0});return}if(B(J,o)){s&&s(B(J,o)||[]);return}te(pe,p()({},o,!0)),e.setState({loading:!0}),i({}).then(function(u){te(J,p()({},o,u.data)),te(re,p()({},o,u.total)),s&&s(u.data,u.total);var c=new CustomEvent("selectGlobalUpdate",{detail:{type:o}});document.dispatchEvent(c)}).finally(function(){e.setState({loading:!1})})}),p()(g()(e),"loadDataWithoutCache",function(){var n=e.props,o=n.loadFunction,i=n.queryParams,s=i===void 0?{}:i,u=n.onLoad;e.setState({loading:!0}),o(s).then(function(c){e.setState({dataSource:c.data,total:c.total}),u&&u(c.data,c.total)}).finally(function(){e.setState({loading:!1})})}),p()(g()(e),"handleOnChange",function(n){var o=e.props,i=o.onChange,s=o.valueKey,u=s===void 0?"id":s,c=o.labelInValue;if(!n){i&&i(n,{});return}i&&i(n,e.state.dataSource.find(function(m){return c?m[u]===(n==null?void 0:n.value):m[u]===n}))}),e.state={loading:!1,dataSource:B(J,l.type)||[]},e}return be()(a,[{key:"componentDidMount",value:function(){this.handleLoadData(),document.addEventListener("selectGlobalUpdate",this.reRender)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("selectGlobalUpdate",this.reRender)}},{key:"componentDidUpdate",value:function(e){(0,Ne.Z)(e.queryParams,this.props.queryParams)||this.handleLoadData()}},{key:"render",value:function(){var e=this.props,n=e.type,o=e.loadFunction,i=e.labelKey,s=i===void 0?"name":i,u=e.valueKey,c=u===void 0?"id":u,m=e.renderLabel,f=e.onChange,h=e.queryParams,F=e.noCache,y=e.showSearch,C=e.optionFilterProp,b=e.allowClear,R=E()(e,kt),x=y!==void 0?y:!0,O=C!==void 0?C:"label",T=b!==void 0?b:!0;return(0,P.jsx)(vn.default,d()(d()({},R),{},{loading:this.state.loading,onChange:this.handleOnChange,options:gn(this.state.dataSource,{labelKey:s,valueKey:c,renderLabel:m}),showSearch:x,optionFilterProp:O,allowClear:T}))}}]),a}(S.Component),Ht=Zt,Wt=["type"],J="@@selectData",pe="@@selectDataIsStart",re="@@selectDataTotal";function zt(r){var t=r.apis,a=t===void 0?[]:t,l=r.defaultProps,e=l===void 0?{}:l;return function(n){var o=n.type,i=E()(n,Wt),s=a.find(function(u){return u.type===o});return s?s.pagination?(0,P.jsx)(Nt,d()(d()(d()({type:o},e),s.defaultProps||{}),{},{loadFunction:s.api},i)):(0,P.jsx)(Ht,d()(d()(d()({type:o},e),s.defaultProps||{}),{},{loadFunction:s.api},i)):null}}var Yt=zt,Gt=function(t){t?(se(J,t),se(pe,t),se(re,t)):(se(J),se(pe),se(re))},xr=function(){return null},Dr=function(){return null},Jt=v(59847),Qt=["labelKey","valueKey","type","loadFunction","nodeDisabled","style","value","onChange","queryParams","noCache"],Xt=function(r){Re()(a,r);var t=Te()(a);function a(l){var e;return Pe()(this,a),e=t.call(this,l),p()(g()(e),"reRender",function(n){n.detail.type===e.props.type&&!e.isNoCache()&&(e.setState({loading:!1,dataSource:B(ve,e.props.type)||[]}),te($e,p()({},e.props.type,!1)),e.props.onLoad&&e.props.onLoad(B(ve,e.props.type)||[]))}),p()(g()(e),"isNoCache",function(){var n=e.props,o=n.queryParams,i=o===void 0?{}:o,s=n.noCache;return Object.keys(i).length>0||s}),p()(g()(e),"handleLoadData",function(){e.isNoCache()?e.loadDataWithoutCache():e.loadDataForCache()}),p()(g()(e),"loadDataForCache",function(){var n=e.props,o=n.type,i=n.loadFunction,s=n.valueKey,u=s===void 0?"id":s,c=n.labelKey,m=c===void 0?"name":c,f=n.onLoad;if(B($e,o)){e.setState({loading:!0});return}if(B(ve,o)){f&&f(B(ve,o));return}te($e,p()({},o,!0)),e.setState({loading:!0}),i({}).then(function(h){te(ve,p()({},o,Me(h,{titleKey:m,valueKey:u}))),f&&f(Me(h,{titleKey:m,valueKey:u}));var F=new CustomEvent("treeSelectGlobalUpdate",{detail:{type:o}});document.dispatchEvent(F)}).finally(function(){e.setState({loading:!1})})}),p()(g()(e),"loadDataWithoutCache",function(){var n=e.props,o=n.loadFunction,i=n.queryParams,s=n.valueKey,u=s===void 0?"id":s,c=n.labelKey,m=c===void 0?"name":c,f=n.onLoad;e.setState({loading:!0}),o(i).then(function(h){e.setState({dataSource:Me(h,{titleKey:m,valueKey:u})}),f&&f(Me(h,{titleKey:m,valueKey:u}))}).finally(function(){e.setState({loading:!1})})}),e.state={loading:!1,dataSource:B(ve,l.type)||[]},e}return be()(a,[{key:"componentDidMount",value:function(){this.handleLoadData(),document.addEventListener("treeSelectGlobalUpdate",this.reRender)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("treeSelectGlobalUpdate",this.reRender)}},{key:"componentDidUpdate",value:function(e){(0,Ne.Z)(e.queryParams,this.props.queryParams)||this.handleLoadData()}},{key:"render",value:function(){var e=this.props,n=e.labelKey,o=e.valueKey,i=e.type,s=e.loadFunction,u=e.nodeDisabled,c=e.style,m=c===void 0?{}:c,f=e.value,h=e.onChange,F=e.queryParams,y=e.noCache,C=E()(e,Qt);return(0,P.jsx)(Jt.Z,d()(d()({showSearch:!0,treeNodeFilterProp:"title",allowClear:!0,placeholder:"\u8BF7\u9009\u62E9"},C),{},{style:d()({width:"100%"},m),loading:this.state.loading,value:f,onChange:function(R,x,O){h&&h(R,x,O)},treeData:Vt(this.state.dataSource||[],u)}))}}]),a}(S.Component),qt=Xt,_t=["type"],ve="@@treeSelectData",$e="@@treeSelectDataIsStart";function er(r){var t=r.apis,a=t===void 0?[]:t,l=r.defaultProps,e=l===void 0?{}:l;return function(n){var o=n.type,i=E()(n,_t),s=a.find(function(u){return u.type===o});return s?(0,P.jsx)(qt,d()(d()(d()({type:o},e),s.defaultProps||{}),{},{loadFunction:s.api},i)):null}}var nr=er,tr=function(t){t?(se(ve,t),se($e,t)):(se(ve),se($e))},Kr=function(){return null},Ir=function(){return null},rr=v(19632),ar=v.n(rr),or=v(2058),ir=v(73935),lr=["value","onChange","multiple","children","onFinish","errorHandle","responseToFileList","nameKey","urlKey"],sr=["urlKey","nameKey","responseToFileList","errorHandle"];function Fn(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=r||[];return t.map(function(a){return a.status||(a.status="done"),a})}function ur(r){var t=r.value,a=r.onChange,l=r.multiple,e=l===void 0?!0:l,n=r.children,o=r.onFinish,i=r.errorHandle,s=r.responseToFileList,u=r.nameKey,c=r.urlKey,m=E()(r,lr),f=(0,S.useContext)(qe)||{},h=f.urlKey,F=f.nameKey,y=f.responseToFileList,C=f.errorHandle,b=E()(f,sr),R=u||F||"name",x=c||h||"url",O=t&&t.filter(Boolean).map(function(X){return d()(d()({},X),{},{name:X[R],url:X[x]})}),T=(0,S.useRef)(null),j=(0,S.useRef)(!0),I=(0,S.useState)(Fn(O)),M=q()(I,2),V=M[0],Z=M[1],D=(0,S.useState)(!1),L=q()(D,2),z=L[0],_=L[1];(0,S.useEffect)(function(){if(j.current){j.current=!1;return}T.current||Z(Fn(O)),T.current=!1},[t]);var ee=function(ae){_(!0);var ue=ar()(ae.fileList),oe=ue.map(function(W){if(W.response){var K=W.response,U=s||y,H=U?U(K):{};return d()(d()({},W),H)}return W});if(ae.file.status==="error"){var ie=i||C;ie&&ie(ae.file.response||{})}if((0,ir.flushSync)(function(){return Z(oe)}),oe.every(function(W){return W.status!=="uploading"})){var A=oe.filter(function(W){return["done","success"].includes(W.status)});a&&(a(A),T.current=!0),o&&o(A),_(!1)}},Q=function(){return n&&(typeof n=="function"?n({loading:z}):(0,S.cloneElement)(n,{loading:z}))};return(0,P.jsx)(or.Z,d()(d()(d()({multiple:e},b),{},{fileList:V,onChange:ee},m),{},{children:Q()}))}var dr=ur,Or=function(){return null},fr=function(t){var a=t.proTableSetting,l=t.modalFormSetting,e=t.schemaFormSetting,n=t.formUploadSetting,o=t.children;return(0,P.jsx)(Je.Provider,{value:a,children:(0,P.jsx)(Qe.Provider,{value:l,children:(0,P.jsx)(Xe.Provider,{value:e,children:(0,P.jsx)(qe.Provider,{value:n,children:o})})})})},cr=fr}}]);
